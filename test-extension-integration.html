<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Extension Integration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #5353ff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #4040dd;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
        .info {
            color: blue;
        }
    </style>
</head>
<body>
    <h1>Extension Integration Test</h1>
    
    <div class="test-section">
        <h2>1. Function Availability Test</h2>
        <button onclick="checkFunctions()">Check Functions</button>
        <div id="function-check" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Simulate Extension Data</h2>
        <button onclick="simulateExtension()">Simulate Extension Bookmark</button>
        <div id="simulate-result" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Test processBookmarkOnce</h2>
        <button onclick="testProcessBookmark()">Test processBookmarkOnce</button>
        <div id="process-result" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output" class="log"></div>
    </div>
    
    <script>
        // Define the functions that the extension expects
        window.handleBookmarkData = function(data) {
            log('handleBookmarkData called with:', JSON.stringify(data, null, 2), 'success');
            // In real app, this would show the modal
            alert('Bookmark data received! Check console for details.');
            console.log('Bookmark data:', data);
        };
        
        window.processBookmarkOnce = function(data) {
            log('processBookmarkOnce called', 'success');
            if (typeof window.handleBookmarkData === 'function') {
                window.handleBookmarkData(data);
            } else {
                log('handleBookmarkData not found!', 'error');
            }
        };
        
        function log(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${timestamp}] ${message}`;
            output.appendChild(entry);
            console.log(message);
        }
        
        function checkFunctions() {
            const result = document.getElementById('function-check');
            const functions = [
                'processBookmarkOnce',
                'handleBookmarkData',
                '_bookmarkProcessing'
            ];
            
            let html = '';
            functions.forEach(fn => {
                const exists = typeof window[fn] !== 'undefined';
                const type = typeof window[fn];
                html += `${fn}: ${exists ? '✅' : '❌'} (${type})\n`;
            });
            
            result.textContent = html;
            log('Function check completed', 'info');
        }
        
        function simulateExtension() {
            const mockData = {
                title: 'Test Bookmark - ' + new Date().toLocaleTimeString(),
                url: 'https://example.com',
                description: 'This is a test bookmark from the simulation',
                screenshot: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',
                timestamp: new Date().toISOString()
            };
            
            log('Simulating extension data...', 'info');
            
            // This simulates what the extension does
            if (typeof window.processBookmarkOnce === 'function') {
                window.processBookmarkOnce(mockData);
                document.getElementById('simulate-result').textContent = 'Bookmark sent successfully!';
            } else {
                document.getElementById('simulate-result').textContent = 'processBookmarkOnce not found!';
                log('processBookmarkOnce not found!', 'error');
            }
        }
        
        function testProcessBookmark() {
            const testData = {
                title: 'Direct Test - ' + Date.now(),
                url: window.location.href,
                timestamp: new Date().toISOString()
            };
            
            log('Testing processBookmarkOnce directly...', 'info');
            
            try {
                window.processBookmarkOnce(testData);
                document.getElementById('process-result').textContent = 'Function called successfully!';
            } catch (e) {
                document.getElementById('process-result').textContent = 'Error: ' + e.message;
                log('Error: ' + e.message, 'error');
            }
        }
        
        // Log initial state
        window.addEventListener('load', () => {
            log('Page loaded', 'info');
            log('Extension functions available: ' + (typeof window.processBookmarkOnce === 'function'), 
                typeof window.processBookmarkOnce === 'function' ? 'success' : 'error');
        });
    </script>
</body>
</html>
